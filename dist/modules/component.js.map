{"version":3,"file":"component.js","sources":["../../src/modules/component.js"],"sourcesContent":["/**\n * component\n * Layui 2 组件构建器\n */\n  import { layui } from '../core.js';\n  import $ from 'jquery';\n  import lay from './lay.js';\n\n  // export\n  export function component(settings) {\n    // 默认设置\n    settings = $.extend(true, {\n      isDeepReload: false // 是否默认为深度重载\n    }, settings);\n\n    // 组件名\n    var MOD_NAME = settings.name;\n    var MOD_ID = 'lay-' + MOD_NAME + '-id'; // 用于记录组件实例 id 的属性名\n\n    // 组件基础对外接口\n    var component = {\n      config: {}, // 全局配置项，一般通过 component.set() 设置\n      index: layui[MOD_NAME] ? (layui[MOD_NAME].index + 10000) : 0, // 组件索引\n\n      // 通用常量集，一般存放固定字符，如类名等\n      CONST: $.extend(true, {\n        MOD_NAME: MOD_NAME,\n        MOD_ID: MOD_ID,\n\n        CLASS_THIS: 'layui-this',\n        CLASS_SHOW: 'layui-show',\n        CLASS_HIDE: 'layui-hide',\n        CLASS_HIDEV: 'layui-hide-v',\n        CLASS_DISABLED: 'layui-disabled',\n        CLASS_NONE: 'layui-none'\n      }, settings.CONST),\n\n      // 设置全局项\n      set: function(options) {\n        var that = this;\n        $.extend(true, that.config, options);\n        return that;\n      },\n\n      // 事件\n      on: function(events, callback) {\n        return layui.onevent.call(this, MOD_NAME, events, callback);\n      }\n    };\n\n    // 操作当前实例\n    var instance = function() {\n      var that = this;\n      var options = that.config;\n      var id = options.id;\n\n      // 实例对象\n      var inst = {\n        config: options,\n        id: id,\n\n        // 重置实例\n        reload: function(options) {\n          that.reload.call(that, options);\n        }\n      };\n\n      // 扩展实例对象的回调\n      if (typeof settings.extendsInstance === 'function') {\n        $.extend(true, inst, settings.extendsInstance.call(that));\n      }\n\n      // 返回实例对象\n      return inst;\n    };\n\n    // 构造器\n    var Class = function(options) {\n      var that = this;\n      that.index = ++component.index; // 每创建一个实例，下标自增\n\n      // 扩展配置项：传入选项 -> 全局选项 -> 默认选项 = 当前选项\n      that.config = $.extend(true, {}, that.config, component.config, options);\n\n      // 初始化之前的回调\n      if (typeof settings.beforeInit === 'function') {\n        settings.beforeInit.call(that, that.config);\n      }\n\n      // 初始化\n      that.init();\n    };\n\n    // 默认配置\n    Class.prototype.config = settings.config;\n\n    // 重载实例\n    Class.prototype.reload = function(options, type) {\n      var that = this;\n      that.config = $.extend(settings.isDeepReload, {}, that.config, options);\n      that.init(true, type);\n    };\n\n    // 初始化准备（若由事件触发渲染，则必经此步）\n    Class.prototype.init = function(rerender, type) {\n      var that = this;\n      var options = that.config;\n      var elem = $(options.elem);\n\n      // 若 elem 非唯一，则拆分为多个实例\n      if (elem.length > 1) {\n        layui.each(elem, function() {\n          component.render($.extend({}, options, {\n            elem: this\n          }));\n        });\n        return that;\n      }\n\n      // 合并 lay-options 属性上的配置信息\n      var layOptions = lay.options(elem[0]);\n      if (rerender) {\n        // 若重载渲染，则重载传入的 options 配置优先\n        options = that.config = $.extend(layOptions, options);\n      } else {\n        $.extend(options, layOptions); // 若首次渲染，则 lay-options 配置优先\n      }\n\n      // 若重复执行 render，则视为 reload 处理\n      if (!rerender && elem.attr(MOD_ID)) {\n        var newThat = component.getInst(elem.attr(MOD_ID));\n        if (!newThat) return;\n        return newThat.reload(options, type);\n      }\n\n      options.elem = $(options.elem);\n\n      // 初始化 id 属性 - 优先取 options.id > 元素 id > 自增索引\n      options.id = lay.hasOwn(options, 'id') ? options.id : (\n        elem.attr('id') || that.index\n      );\n\n      // 记录当前实例对象\n      instance.that[options.id] = that;\n\n      // 渲染之前的回调\n      if (typeof settings.beforeRender === 'function') {\n        settings.beforeRender.call(that, options);\n      }\n\n      // 渲染\n      if (typeof that.render === 'function') {\n        component.cache.id[options.id] = null; // 记录所有实例 id，用于批量操作（如 resize）\n        elem.attr(MOD_ID, options.id); // 目标元素已渲染过的标记\n        that.render(rerender); // 渲染核心\n      }\n\n      // 事件\n      typeof that.events === 'function' && that.events();\n    };\n\n    // 组件必传项\n    Class.prototype.render = settings.render; // 渲染\n    Class.prototype.events = settings.events; // 事件\n\n    /**\n     * 元素缓存操作\n     * @param {string} key - 缓存键\n     * @param {*} value - 缓存值\n     * @param {boolean} remove - 是否删除缓存\n     * @returns {*} - 若 value 未传，则返回缓存值\n     */\n    Class.prototype.cache = function(key, value, remove) {\n      var that = this;\n      var options = that.config;\n      var elem = options.elem;\n      var MOD_CACHE_NAME = MOD_ID + '-cache';\n      if (!elem) return;\n\n      var cache = elem.data(MOD_CACHE_NAME) || {};\n\n      // value 未传则获取缓存值\n      if (value === undefined) {\n        return cache[key];\n      }\n\n      if (remove) {\n        delete cache[key]; // 删除缓存\n      } else {\n        cache[key] = value; // 设置缓存\n      }\n\n      elem.data(MOD_CACHE_NAME, cache);\n    };\n\n    // 清除缓存\n    Class.prototype.removeCache = function(key) {\n      this.cache(key, null, true);\n    };\n\n    // 缓存所有实例对象\n   instance.that = {};\n\n    // 获取指定的实例对象\n    component.getInst = component.getThis = function(id) {\n      if (id === undefined) {\n        throw new Error('ID argument required');\n      }\n      return instance.that[id];\n    };\n\n    // 获取所有实例\n    component.getAllInst = function() {\n      return instance.that;\n    };\n\n    // 移除指定的实例对象\n    component.removeInst = function(id) {\n      delete instance.that[id];\n      delete component.cache.id[id];\n    };\n\n    // 组件缓存\n    component.cache = {\n      id: {}\n    };\n\n    // 用于扩展原型\n    component.Class = Class;\n\n    /**\n     * 组件完整重载\n     * @param {string} id - 实例 id\n     * @param {Object} options - 配置项\n     * @returns\n     */\n    component.reload = function(id, options) {\n      var that = component.getInst(id);\n      if (!that) return;\n\n      that.reload(options);\n      return instance.call(that);\n    };\n\n    /**\n     * 组件渲染\n     * @param {Object} options - 配置项\n     * @returns\n     */\n    component.render = function(options) {\n      var inst = new Class(options);\n      return instance.call(inst);\n    };\n\n    return component;\n  }\n  export default component;\n"],"names":[],"mappings":"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"}