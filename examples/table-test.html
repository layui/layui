<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>è¡¨æ ¼æ“ä½œ - layui</title>

  <link rel="stylesheet" href="../src/css/layui.css">
  <style>
    body {padding: 32px; /*overflow-y: scroll;*/}
  </style>
</head>
<body>

<div class="layui-btn-container">
  <a href="table.html" class="layui-btn">è¡¨æ ¼ç»¼åˆ</a>
  <a href="table-test.html" class="layui-btn layui-btn-primary layui-border-green">è¡¨æ ¼æ“ä½œ</a>
  <a href="table-static.html" class="layui-btn">é™æ€è¡¨æ ¼</a>
</div>

<script type="text/html" id="toolbarDemo">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm" lay-event="getCheckData">è·å–é€‰ä¸­è¡Œæ•°æ®</button>
    <button class="layui-btn layui-btn-sm" lay-event="getData">è·å–å½“å‰é¡µæ•°æ®</button>
    <button class="layui-btn layui-btn-sm" lay-event="isAll">æ˜¯å¦å…¨é€‰</button>

    <button class="layui-btn layui-btn-sm" id="reloadTest">
      é‡è½½æµ‹è¯• 
      <i class="layui-icon layui-icon-down layui-font-12"></i>
    </button>
    <button class="layui-btn layui-btn-sm" id="moreTest">
      æ›´å¤šæµ‹è¯• 
      <i class="layui-icon layui-icon-down layui-font-12"></i>
    </button>
  </div>
</script>

<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">ç¼–è¾‘</a>
  {{# if(layui.$.trim(d.email)){ }}
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>
  {{# } }}
  <input type="checkbox" name="demoTableSwitch" lay-skin="switch" {{ d.demoTableSwitch }}>
</script>

<script type="text/html" id="usernameTpl">
  <a href="" class="layui-table-link">{{d.username || ''}}</a>
</script>

<script type="text/html" id="switchTpl">
  <input type="checkbox" name="yyy" lay-skin="switch" lay-text="å¥³|ç”·">
</script>

<script type="text/html" id="cityTpl">
  <select id="demoCity1" lay-ignore>
    <option value="æµ™æ±Ÿæ­å·">æµ™æ±Ÿæ­å·</option>
    <option value="æ±Ÿè¥¿å—æ˜Œ">æ±Ÿè¥¿å—æ˜Œ</option>
    <option value="æ¹–åŒ—æ­¦æ±‰">æ¹–åŒ—æ­¦æ±‰</option>
  </select>
</script>

<script type="text/html" id="checkboxTpl">
  <input type="checkbox" name="" title="é”å®š" checked>
</script>

<script type="text/html" id="pagebarDemo">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm" lay-event="footerDemoBtn1">åº•éƒ¨æŒ‰é’®1</button>
    <button class="layui-btn layui-btn-sm" lay-event="footerDemoBtn2">åº•éƒ¨æŒ‰é’®2</button>
  </div>
</script>

<table id="test" lay-filter="test"></table>

<script src="../src/layui.js" src1="https://cdn.staticfile.org/layui/2.6.13/layui.js"></script>
<script>
(function(off){
  if(!off) return;
  layui.disuse('table').extend({
    table: '{/}//ww:5018/layui/2.6.13/src/modules/table'
  });
})();

layui.use(['table', 'dropdown'], function(){
  var $ = layui.$;
  var table = layui.table;
  var laytpl = layui.laytpl;
  var dropdown = layui.dropdown;
  var form = layui.form;


  // ä»…ç”¨äºå„ç±»æµ‹è¯•çš„è¡¨å¤´
  var test_cols = [[
    {type: 'checkbox', fixed: 'left'}
    ,{field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true, totalRowText: 'åˆè®¡ï¼š'}
    ,{field:'username', title:'ç”¨æˆ·å', width:120, edit: 'text'}
    ,{field:'email', title:'é‚®ç®± <i class="layui-icon layui-icon-email"></i>', hide: 0, width:150, edit: 'text'}
    ,{field:'sex', title:'æ€§åˆ«', width:80, edit: 'text', sort: true}
    ,{field:'city', title:'åŸå¸‚', width: 120}
    ,{field:'sign', title:'ç­¾å'}
    ,{field: 'experience', title: 'ç§¯åˆ†', width:80, sort: true, align:'center', totalRow: '{{ d.TOTAL_NUMS }} ğŸ˜Š'}
    ,{fixed: 'right', title:'æ“ä½œ', toolbar: '#barDemo', width:150}
  ]];

  // å…¨å±€è®¾å®šæŸå‚æ•°
  table.set({
    where: {
      token: 'é»˜è®¤ token å‚æ•°'
    }
    //,defaultToolbar: ['filter']
    ,limit: 30
    //,url: 'list'
    //,height: 300
  });
  
  //æ¸²æŸ“
  window.ins1 = table.render({
    elem: '#test'
    ,height: 520
    //,width: 600
    ,title: 'ç”¨æˆ·æ•°æ®è¡¨'
    ,url: 'json/table/demo1.json'
    //,method: 'post'

    
    //,lineStyle: 'height: 95px;' // è¡Œæ ·å¼
    ,css: [ // è‡ªå®šä¹‰æ ·å¼
      '.layui-table-page{text-align: right;}'
      ,'.layui-table-pagebar{float: left;}'
    ].join('')
    //,className: '.demo-table-view'

    //,size: 'lg'
    //,skin: 'line'
    //,loading: false

    ,totalRow: true
    ,pagebar: '#pagebarDemo' // åˆ†é¡µæ æ¨¡æ¿
    ,page: !1 ? false : {
      //curr: layui.data('tableCache').curr || 1 // è¯»å–è®°å½•ä¸­çš„é¡µç ï¼Œèµ‹å€¼ç»™èµ·å§‹é¡µ
    }
    ,limit: 30
    ,toolbar: '#toolbarDemo'
    ,defaultToolbar: ['filter', 'exports', 'print', {
      title: 'å¸®åŠ©'
      ,layEvent: 'LAYTABLE_TIPS'
      ,icon: 'layui-icon-tips'
    }]
    //,escape: false
    ,editTrigger: 'dblclick'
    ,cols: !1 ? test_cols : [[
      {type: 'checkbox', fixed: 'left'}
      //,{type: 'numbers', fixed: 'left'}
      ,{field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true, totalRowText: 'åˆè®¡ï¼š'}
      ,{field:'username', title:'ç”¨æˆ·å', width:120, edit: function(d){
        return !d.LAY_DISABLED;
      }, templet: '#usernameTpl'}
      ,{field:'email', minWidth: 160, title:'é‚®ç®± <i class="layui-icon layui-icon-email"></i>', hide: 0, edit: 'text', templet: function(d){
        return '<em>'+ layui.util.escape(d.email) +'</em>'
      }}
      ,{field:'sex', title:'æ€§åˆ«', width:80, edit: 'text', sort: true, escape: false}
      ,{field:'city', title:'åŸå¸‚', width:120, templet: '#cityTpl', exportTemplet: function(d, obj){
        //console.log(obj)
        var td = obj.td(this.field); //è·å–å½“å‰ td
        return td.find('select').val();
      }}
      ,{field:'sign', title:'ç­¾å', minWidth: 200, style:'color: #5FB878', edit: 'textarea'}
      ,{field: 'experience', title: 'ç§¯åˆ†', width: 100, sort: true, align:'center', totalRow: !1 ? true : '{{= d.TOTAL_NUMS }} åˆ† ğŸ˜Š', templet: '<div><a href="" class="layui-table-link">{{= d[d.LAY_COL.field] }}</a> åˆ†</div>'}
      ,{field:'ip', title:'IP', width: 120, align: 'right'}
      ,{field:'checkin', title:'æ‰“å¡', width: 100, sort: true, totalRow: '{{= parseInt(d.TOTAL_NUMS) }} æ¬¡'}
      ,{field:'joinTime', title:'åŠ å…¥æ—¶é—´', width: 120}
      ,{fixed: 'right', title:'æ“ä½œ', toolbar: '#barDemo', width: 180}
    ]]
    
    //,autoSort: false // ç¦ç”¨å‰ç«¯è‡ªåŠ¨æ’åºï¼Œç”±æœåŠ¡çš„å®Œæˆæ’åº
    ,initSort111: { // åˆå§‹æ’åºçŠ¶æ€
      field: 'experience' //æ’åºå­—æ®µï¼Œå¯¹åº” cols è®¾å®šçš„å„å­—æ®µå
      ,type: 'desc' //æ’åºæ–¹å¼  asc: å‡åºã€desc: é™åºã€null: é»˜è®¤æ’åº
    }
    
    ,headers: {headers_token: 'sasasas'}
    ,where: {
      test: 'åˆå§‹ test å‚æ•°'
      ,token: 'åˆå§‹ token'
      ,key: 'experience'
      ,order: 'asc'
    }
    ,before: function(options){
      options.where.AAAAA = 123;
      //console.log(options)
    }
    ,done: function(res, curr, count){
      var id = this.id;

      // è®°å½•å½“å‰é¡µç 
      /*
      layui.data('tableCache', {
        key: 'curr',
        value: curr
      });
      */

      // é‡è½½æµ‹è¯•
      dropdown.render({
        elem: '#reloadTest' //å¯ç»‘å®šåœ¨ä»»æ„å…ƒç´ ä¸­ï¼Œæ­¤å¤„ä»¥ä¸Šè¿°æŒ‰é’®ä¸ºä¾‹
        ,data: [{
          id: 'reload',
          title: 'é‡è½½'
        },{
          id: 'reload-deep',
          title: 'é‡è½½ - å‚æ•°å åŠ '
        },{
          id: 'reloadData',
          title: 'ä»…é‡è½½æ•°æ®'
        },{
          id: 'reloadData-deep',
          title: 'ä»…é‡è½½æ•°æ® - å‚æ•°å åŠ '
        }]
        // èœå•è¢«ç‚¹å‡»çš„äº‹ä»¶
        ,click: function(obj){
          switch(obj.id){
            case 'reload':
              // é‡è½½ - é»˜è®¤ï¼ˆå‚æ•°é‡ç½®ï¼‰
              table.reload('test', {
                where: {
                  abc: '123456'
                  //,test: 'æ–°çš„ test2'
                  //,token: 'æ–°çš„ token2'
                }
                ,height: 'full-130' // é‡è½½é«˜åº¦
                /*
                ,cols: [[ // é‡ç½®è¡¨å¤´
                  {type: 'checkbox', fixed: 'left'}
                  ,{field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true, totalRowText: 'åˆè®¡ï¼š'}
                  ,{field:'sex', title:'æ€§åˆ«', width:80, edit: 'text', sort: true}
                  ,{field:'experience', title:'ç§¯åˆ†', width:80, sort: true, totalRow: true, templet: '<div>{{ d.experience }} åˆ†</div>'}
                  ,{field:'logins', title:'ç™»å…¥æ¬¡æ•°', width:100, sort: true, totalRow: true}
                  ,{field:'joinTime', title:'åŠ å…¥æ—¶é—´', width:120}
                ]]
                */
                
              });
            break;
            case 'reload-deep':
              // é‡è½½ - æ·±åº¦ï¼ˆå‚æ•°å åŠ ï¼‰
              table.reload('test', {
                where: {
                  abc: 123
                  ,test: 'æ–°çš„ test1'
                }
                //,defaultToolbar: ['print'] // é‡è½½å¤´éƒ¨å·¥å…·æ å³ä¾§å›¾æ ‡
                ,page: {curr: 5, limit: 20}
                //,cols: ins1.config.cols
              }, true);
            break;
            case 'reloadData':
              // æ•°æ®é‡è½½ - å‚æ•°é‡ç½®
              table.reloadData('test', {
                where: {
                  abc: '123456'
                  //,test: 'æ–°çš„ test2'
                  //,token: 'æ–°çš„ token2'
                }
                ,height: 2000 // æµ‹è¯•æ— æ•ˆå‚æ•°
                //,url: '404'
                //,elem: null
                //,page: {curr: 5, limit: 20}
                ,scrollPos: 'fixed' // ä¿æŒæ»šåŠ¨æ¡ä½ç½®ä¸å˜
              });
            break;
            case 'reloadData-deep':
              // æ•°æ®é‡è½½ - å‚æ•°å åŠ 
              table.reloadData('test', {
                where: {
                  abc: 123
                  ,test: 'æ–°çš„ test1'
                }
              }, true);
            break;
          }
          layer.msg('å¯è§‚å¯Ÿ Network è¯·æ±‚å‚æ•°çš„å˜åŒ–');
        }
      });


      // æ›´å¤šæµ‹è¯•
      dropdown.render({
        elem: '#moreTest' //å¯ç»‘å®šåœ¨ä»»æ„å…ƒç´ ä¸­ï¼Œæ­¤å¤„ä»¥ä¸Šè¿°æŒ‰é’®ä¸ºä¾‹
        ,data: [{
          id: 'add',
          title: 'æ·»åŠ '
        },{
          id: 'update',
          title: 'ç¼–è¾‘'
        },{
          id: 'delete',
          title: 'åˆ é™¤'
        }]
        //èœå•è¢«ç‚¹å‡»çš„äº‹ä»¶
        ,click: function(obj){
          var checkStatus = table.checkStatus(id)
          var data = checkStatus.data; // è·å–é€‰ä¸­çš„æ•°æ®

          switch(obj.id){
            case 'add':
              layer.open({
                title: 'æ·»åŠ ',
                type: 1,
                area: ['80%','80%'],
                content: '<div style="padding: 16px;">è‡ªå®šä¹‰è¡¨å•å…ƒç´ </div>'
              });
            break;
            case 'update':
              layer.open({
                title: 'ç¼–è¾‘',
                type: 1,
                area: ['80%','80%'],
                content: '<div style="padding: 16px;">è‡ªå®šä¹‰è¡¨å•å…ƒç´ </div>'
              });
            break;
            case 'delete':
              if(data.length === 0){
                return layer.msg('è¯·é€‰æ‹©ä¸€è¡Œ');
              }
              layer.msg('delete event');
            break;
          }
        }
      });
    }
    
    ,error: function(res, msg){
      console.log(res, msg)
    }

    /*
    ,request: { // è‡ªå®šä¹‰è¯·æ±‚å‚æ•°åç§°
      pageName: 'curr' //é¡µç çš„å‚æ•°åç§°ï¼Œé»˜è®¤ï¼špage
      ,limitName: 'nums' //æ¯é¡µæ•°æ®é‡çš„å‚æ•°åï¼Œé»˜è®¤ï¼šlimit
    }
    ,parseData: function(res){ // ä»»æ„æ•°æ®æ ¼å¼çš„è§£æ
      return {
        "status": res.status
        ,"msg": res.message
        ,"count": res.total
        ,"data": res.data.list
      };
    }
    */
  });
  
  //æ’åºäº‹ä»¶
  table.on('sort(test)', function(obj){
    //console.log(obj);

    //return;
    layer.msg('æœåŠ¡ç«¯æ’åºã€‚order by '+ obj.field + ' ' + obj.type);

    //æœåŠ¡ç«¯æ’åº
    table.reloadData('test', {
      //initSort: obj,
      //page: {curr: 1}, //é‡æ–°ä»ç¬¬ä¸€é¡µå¼€å§‹
      where: { // å‘æœåŠ¡ç«¯ä¼ å…¥æ’åºå‚æ•°
        key: obj.field, //æ’åºå­—æ®µ
        order: obj.type //æ’åºæ–¹å¼
      }
    });
  });
  
  // å·¥å…·æ äº‹ä»¶
  table.on('toolbar(test)', function(obj){
    var id = obj.config.id;
    var checkStatus = table.checkStatus(id);

    switch(obj.event){
      case 'getCheckData':
        var data = checkStatus.data;
        layer.alert(layui.util.escape(JSON.stringify(data)));
      break;
      case 'getData':
        var getData = table.getData(id);
        console.log(getData);
        layer.alert(layui.util.escape(JSON.stringify(getData)));
      break;
      case 'isAll':
        layer.msg(checkStatus.isAll ? 'å…¨é€‰': 'æœªå…¨é€‰')
      break;
      case 'LAYTABLE_TIPS':
        layer.alert('Table for layui-v'+ layui.v);
      break;
    };
  });

  //è§¦å‘å•å…ƒæ ¼å·¥å…·äº‹ä»¶
  table.on('tool(test)', function(obj){ // åŒå‡» toolDouble
    var data = obj.data;
    //console.log(obj)
    if(obj.event === 'del'){
      layer.confirm('çœŸçš„åˆ é™¤è¡Œä¹ˆ', function(index){
        obj.del();
        layer.close(index);
      });
    } else if(obj.event === 'edit'){
      layer.prompt({
        formType: 2
        ,value: data.email
      }, function(value, index){
        obj.update({
          email: value
        }, true); // å‚æ•° true ä¸ºæ–°ç‰ˆæ–°å¢åŠŸèƒ½ï¼Œè¯¦è§æ–‡æ¡£

        /*
        // ä¸Šè¿° obj.update() åªæ˜¯åœ¨å‰ç«¯ä¸´æ—¶æ›´æ–°æ•°æ®è§†å›¾
        // åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œå½“å‘é€ä¿®æ”¹è¯·æ±‚æˆåŠŸåï¼Œå¯å†æ‰§è¡Œ reloadData æ¥é‡è½½æ•°æ®
        table.reloadData('test', {
          scrollPos: 'fixed' // ä¿æŒæ»šåŠ¨æ¡ä½ç½®ä¸å˜
        });
        */
        layer.close(index);
      });
    }
  });



  //è§¦å‘è¡¨æ ¼å¤é€‰æ¡†é€‰æ‹©
  table.on('checkbox(test)', function(obj){
    console.log(obj)
  });

  //è§¦å‘è¡¨æ ¼å•é€‰æ¡†é€‰æ‹©
  table.on('radio(test)', function(obj){
    console.log(obj)
  });
  
  // è¡Œå•å‡»äº‹ä»¶
  table.on('row(test)', function(obj){
    //console.log(obj);
    //layer.closeAll('tips');
  });
  // è¡ŒåŒå‡»äº‹ä»¶
  table.on('rowDouble(test)', function(obj){
    console.log(obj);
  });

  // å•å…ƒæ ¼ç¼–è¾‘äº‹ä»¶
  table.on('edit(test)', function(obj){
    var field = obj.field //å¾—åˆ°å­—æ®µ
    ,value = obj.value //å¾—åˆ°ä¿®æ”¹åçš„å€¼
    ,data = obj.data; //å¾—åˆ°æ‰€åœ¨è¡Œæ‰€æœ‰é”®å€¼

    var update = {};
    update[field] = value;
    obj.update(update, true); // å‚æ•° true ä¸ºæ–°ç‰ˆæ–°å¢åŠŸèƒ½ï¼Œè¯¦è§æ–‡æ¡£
  });
});
</script>
</body>
</html>
